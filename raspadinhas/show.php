<?php @session_start();<?php 
require_once '../conexao.php';<?php if (!isset($_SESSION['usuario_id']))<?php {<?php $_SESSION['message']<?php =<?php ['type'<?php =><?php 'warning',<?php 'text'<?php =><?php 'Você<?php precisa estar logado para acessar esta página!'];<?php header("Location:<?php /login");<?php exit;<?php 
}<?php $id =<?php (int)($_GET['id']<?php ??<?php 0);<?php 
$stmt =<?php $pdo->prepare("SELECT *<?php FROM raspadinhas WHERE id =<?php ?");<?php 
$stmt->execute([$id]);<?php 
$cartela =<?php $stmt->fetch(PDO::FETCH_ASSOC);<?php if (!$cartela)<?php {<?php $_SESSION['message']<?php =<?php ['type'<?php =><?php 'failure',<?php 'text'<?php =><?php 'Cartela não encontrada.'];<?php header("Location:<?php /raspadinhas");<?php exit;<?php 
}<?php $premios =<?php $pdo->prepare("SELECT *<?php FROM raspadinha_premios WHERE raspadinha_id =<?php ?<?php ORDER BY valor DESC");<?php 
$premios->execute([$id]);<?php 
$premios =<?php $premios->fetchAll(PDO::FETCH_ASSOC);<?php 
?><?php <!DOCTYPE html><?php 
<html lang="pt-BR"><?php 
<head><?php <meta charset="UTF-8"><?php <meta name="viewport"<?php content="width=device-width,<?php initial-scale=1.0"><?php <title><?php echo $nomeSite;?><?php -<?php <?php=<?php htmlspecialchars($cartela['nome']);<?php ?></title><?php <?php <!--<?php Fonts --><?php <link rel="preconnect"<?php href="https://fonts.googleapis.com"><?php <link rel="preconnect"<?php href="https://fonts.gstatic.com"<?php crossorigin><?php <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&display=swap"<?php rel="stylesheet"><?php <?php <!--<?php Icons --><?php <link rel="stylesheet"<?php href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css"><?php <?php <!--<?php Styles --><?php <link rel="stylesheet"<?php href="/assets/style/globalStyles.css?id=<?php=<?php time();<?php ?>"><?php <?php <!--<?php Scripts --><?php <script src="https://cdn.jsdelivr.net/npm/notiflix@3.2.8/dist/notiflix-aio-3.2.8.min.js"></script><?php <link href="https://cdn.jsdelivr.net/npm/notiflix@3.2.8/src/notiflix.min.css"<?php rel="stylesheet"><?php <script src="https://cdn.jsdelivr.net/npm/js-confetti@latest/dist/js-confetti.browser.js"></script><?php <?php <style><?php /*<?php Page Styles */<?php .raspadinha-section {<?php margin-top:<?php 100px;<?php padding:<?php 4rem 0;<?php background:<?php #0a0a0a;<?php min-height:<?php calc(100vh -<?php 200px);<?php }<?php <?php .raspadinha-container {<?php max-width:<?php 800px;<?php margin:<?php 0 auto;<?php padding:<?php 0 2rem;<?php }<?php <?php /*<?php Header Card */<?php .header-card {<?php background:<?php linear-gradient(135deg,<?php rgba(34,<?php 197,<?php 94,<?php 0.1),<?php rgba(16,<?php 163,<?php 74,<?php 0.05));<?php border:<?php 1px solid rgba(34,<?php 197,<?php 94,<?php 0.2);<?php border-radius:<?php 24px;<?php padding:<?php 2rem;<?php margin-bottom:<?php 3rem;<?php position:<?php relative;<?php overflow:<?php hidden;<?php }<?php <?php .header-card::before {<?php content:<?php '';<?php position:<?php absolute;<?php top:<?php -50%;<?php right:<?php -50%;<?php width:<?php 200px;<?php height:<?php 200px;<?php background:<?php linear-gradient(45deg,<?php rgba(34,<?php 197,<?php 94,<?php 0.1),<?php transparent);<?php border-radius:<?php 50%;<?php animation:<?php float 6s ease-in-out infinite;<?php }<?php <?php .header-card::after {<?php content:<?php '';<?php position:<?php absolute;<?php bottom:<?php -50%;<?php left:<?php -50%;<?php width:<?php 150px;<?php height:<?php 150px;<?php background:<?php linear-gradient(45deg,<?php rgba(34,<?php 197,<?php 94,<?php 0.05),<?php transparent);<?php border-radius:<?php 50%;<?php animation:<?php float 8s ease-in-out infinite reverse;<?php }<?php <?php @keyframes float {<?php 0%,<?php 100%<?php {<?php transform:<?php translateY(0)<?php rotate(0deg);<?php }<?php 50%<?php {<?php transform:<?php translateY(-20px)<?php rotate(180deg);<?php }<?php }<?php <?php .cartela-banner {<?php width:<?php 100%;<?php height:<?php 200px;<?php border-radius:<?php 20px;<?php overflow:<?php hidden;<?php position:<?php relative;<?php margin-bottom:<?php 2rem;<?php box-shadow:<?php 0 10px 40px rgba(0,<?php 0,<?php 0,<?php 0.3);<?php }<?php <?php .cartela-image {<?php width:<?php 100%;<?php height:<?php 100%;<?php object-fit:<?php cover;<?php }<?php <?php .cartela-overlay {<?php position:<?php absolute;<?php inset:<?php 0;<?php background:<?php linear-gradient(45deg,<?php rgba(0,<?php 0,<?php 0,<?php 0.3),<?php rgba(34,<?php 197,<?php 94,<?php 0.1));<?php display:<?php flex;<?php align-items:<?php center;<?php justify-content:<?php center;<?php }<?php <?php .cartela-title {<?php color:<?php white;<?php font-size:<?php 2.5rem;<?php font-weight:<?php 900;<?php text-align:<?php center;<?php text-shadow:<?php 2px 2px 4px rgba(0,<?php 0,<?php 0,<?php 0.7);<?php padding:<?php 0 1rem;<?php }<?php <?php .price-badge {<?php position:<?php absolute;<?php bottom:<?php 1rem;<?php left:<?php 50%;<?php transform:<?php translateX(-50%);<?php background:<?php linear-gradient(135deg,<?php #22c55e,<?php #16a34a);<?php color:<?php white;<?php padding:<?php 0.5rem 1.5rem;<?php border-radius:<?php 25px;<?php font-weight:<?php 700;<?php font-size:<?php 1.1rem;<?php box-shadow:<?php 0 4px 16px rgba(34,<?php 197,<?php 94,<?php 0.4);<?php }<?php <?php /*<?php Instructions */<?php .instructions {<?php background:<?php rgba(34,<?php 197,<?php 94,<?php 0.1);<?php border:<?php 1px solid rgba(34,<?php 197,<?php 94,<?php 0.2);<?php border-radius:<?php 16px;<?php padding:<?php 1.5rem;<?php margin-bottom:<?php 2rem;<?php text-align:<?php center;<?php }<?php <?php .instructions h3 {<?php color:<?php #22c55e;<?php font-weight:<?php 700;<?php margin-bottom:<?php 1rem;<?php }<?php <?php .instructions-list {<?php display:<?php grid;<?php grid-template-columns:<?php repeat(auto-fit,<?php minmax(200px,<?php 1fr));<?php gap:<?php 1rem;<?php color:<?php #e5e7eb;<?php }<?php <?php .instruction-item {<?php display:<?php flex;<?php align-items:<?php center;<?php gap:<?php 0.5rem;<?php font-size:<?php 0.9rem;<?php }<?php <?php .instruction-icon {<?php color:<?php #22c55e;<?php font-size:<?php 1.1rem;<?php }<?php <?php /*<?php Prizes Section */<?php .prizes-section {<?php background:<?php rgba(10,<?php 10,<?php 10,<?php 0.6);<?php border:<?php 1px solid rgba(34,<?php 197,<?php 94,<?php 0.1);<?php border-radius:<?php 16px;<?php padding:<?php 2rem;<?php margin-top:<?php 2rem;<?php }<?php <?php .prizes-title {<?php color:<?php #ffffff;<?php font-size:<?php 1.1rem;<?php font-weight:<?php 700;<?php text-align:<?php center;<?php margin-bottom:<?php 1.5rem;<?php display:<?php flex;<?php align-items:<?php center;<?php justify-content:<?php center;<?php gap:<?php 0.5rem;<?php text-transform:<?php uppercase;<?php letter-spacing:<?php 0.5px;<?php }<?php <?php .prizes-title i {<?php color:<?php #22c55e;<?php font-size:<?php 1.2rem;<?php }<?php <?php .prizes-grid {<?php display:<?php grid;<?php grid-template-columns:<?php repeat(auto-fill,<?php minmax(140px,<?php 1fr));<?php gap:<?php 1rem;<?php max-height:<?php 320px;<?php overflow-y:<?php auto;<?php padding:<?php 0.5rem;<?php }<?php <?php /*<?php Custom scrollbar for prizes grid */<?php .prizes-grid::-webkit-scrollbar {<?php width:<?php 6px;<?php }<?php <?php .prizes-grid::-webkit-scrollbar-track {<?php background:<?php rgba(255,<?php 255,<?php 255,<?php 0.05);<?php border-radius:<?php 3px;<?php }<?php <?php .prizes-grid::-webkit-scrollbar-thumb {<?php background:<?php #22c55e;<?php border-radius:<?php 3px;<?php }<?php <?php .prizes-grid::-webkit-scrollbar-thumb:hover {<?php background:<?php #16a34a;<?php }<?php <?php .prize-card {<?php background:<?php rgba(0,<?php 0,<?php 0,<?php 0.6);<?php border:<?php 1px solid rgba(34,<?php 197,<?php 94,<?php 0.2);<?php border-radius:<?php 12px;<?php padding:<?php 1rem;<?php text-align:<?php center;<?php transition:<?php all 0.3s ease;<?php position:<?php relative;<?php overflow:<?php hidden;<?php }<?php <?php .prize-card::before {<?php content:<?php '';<?php position:<?php absolute;<?php top:<?php 0;<?php left:<?php 0;<?php right:<?php 0;<?php bottom:<?php 0;<?php background:<?php linear-gradient(135deg,<?php rgba(34,<?php 197,<?php 94,<?php 0.1)<?php 0%,<?php transparent 100%);<?php opacity:<?php 0;<?php transition:<?php opacity 0.3s ease;<?php }<?php <?php .prize-card:hover::before {<?php opacity:<?php 1;<?php }<?php <?php .prize-card:hover {<?php border-color:<?php rgba(34,<?php 197,<?php 94,<?php 0.4);<?php transform:<?php translateY(-2px);<?php box-shadow:<?php 0 8px 25px rgba(34,<?php 197,<?php 94,<?php 0.15);<?php }<?php <?php .prize-image {<?php width:<?php 64px;<?php height:<?php 64px;<?php margin:<?php 0 auto 0.75rem;<?php display:<?php flex;<?php align-items:<?php center;<?php justify-content:<?php center;<?php border-radius:<?php 8px;<?php background:<?php rgba(34,<?php 197,<?php 94,<?php 0.1);<?php border:<?php 1px solid rgba(34,<?php 197,<?php 94,<?php 0.2);<?php position:<?php relative;<?php z-index:<?php 2;<?php }<?php <?php .prize-image img {<?php width:<?php 48px;<?php height:<?php 48px;<?php object-fit:<?php contain;<?php filter:<?php drop-shadow(0 2px 4px rgba(0,<?php 0,<?php 0,<?php 0.3));<?php }<?php <?php .prize-info {<?php position:<?php relative;<?php z-index:<?php 2;<?php }<?php <?php .prize-name {<?php color:<?php #e5e7eb;<?php font-size:<?php 0.8rem;<?php font-weight:<?php 600;<?php margin-bottom:<?php 0.25rem;<?php line-height:<?php 1.2;<?php }<?php <?php .prize-value {<?php color:<?php #22c55e;<?php font-size:<?php 0.9rem;<?php font-weight:<?php 700;<?php }<?php <?php /*<?php Game Container */<?php .game-container {<?php background:<?php rgba(20,<?php 20,<?php 20,<?php 0.8);<?php border:<?php 1px solid rgba(255,<?php 255,<?php 255,<?php 0.1);<?php border-radius:<?php 24px;<?php padding:<?php 2rem;<?php backdrop-filter:<?php blur(20px);<?php box-shadow:<?php 0 20px 60px rgba(0,<?php 0,<?php 0,<?php 0.5);<?php position:<?php relative;<?php }<?php <?php .game-title {<?php color:<?php white;<?php font-size:<?php 1.5rem;<?php font-weight:<?php 700;<?php text-align:<?php center;<?php margin-bottom:<?php 2rem;<?php display:<?php flex;<?php align-items:<?php center;<?php justify-content:<?php center;<?php gap:<?php 0.5rem;<?php }<?php <?php /*<?php Scratch Container */<?php #scratch-container {<?php position:<?php relative;<?php width:<?php 100%;<?php max-width:<?php 500px;<?php aspect-ratio:<?php 1 /<?php 1;<?php margin:<?php 0 auto 2rem;<?php border-radius:<?php 20px;<?php user-select:<?php none;<?php box-shadow:<?php 0 10px 40px rgba(0,<?php 0,<?php 0,<?php 0.3);<?php overflow:<?php hidden;<?php }<?php <?php #prizes-grid {<?php position:<?php absolute;<?php top:<?php 0;<?php left:<?php 0;<?php width:<?php 100%;<?php height:<?php 100%;<?php display:<?php grid;<?php grid-template-columns:<?php repeat(3,<?php 1fr);<?php grid-template-rows:<?php repeat(3,<?php 1fr);<?php gap:<?php 8px;<?php padding:<?php 12px;<?php background:<?php linear-gradient(135deg,<?php #1f2937,<?php #374151);<?php color:<?php white;<?php border-radius:<?php 20px;<?php z-index:<?php 1;<?php }<?php <?php #prizes-grid ><?php div {<?php background:<?php rgba(0,<?php 0,<?php 0,<?php 0.8);<?php border:<?php 1px solid rgba(34,<?php 197,<?php 94,<?php 0.2);<?php border-radius:<?php 12px;<?php display:<?php flex;<?php flex-direction:<?php column;<?php justify-content:<?php center;<?php align-items:<?php center;<?php font-weight:<?php 600;<?php font-size:<?php 0.85rem;<?php transition:<?php all 0.3s ease;<?php position:<?php relative;<?php overflow:<?php hidden;<?php }<?php <?php #prizes-grid ><?php div::before {<?php content:<?php '';<?php position:<?php absolute;<?php inset:<?php 0;<?php background:<?php linear-gradient(45deg,<?php rgba(34,<?php 197,<?php 94,<?php 0.1),<?php transparent);<?php opacity:<?php 0;<?php transition:<?php opacity 0.3s ease;<?php }<?php <?php #prizes-grid ><?php div:hover::before {<?php opacity:<?php 1;<?php }<?php <?php #prizes-grid img {<?php width:<?php 48px;<?php height:<?php 48px;<?php object-fit:<?php contain;<?php margin-bottom:<?php 6px;<?php filter:<?php drop-shadow(0 2px 4px rgba(0,<?php 0,<?php 0,<?php 0.3));<?php }<?php <?php #scratch-canvas {<?php position:<?php absolute;<?php top:<?php 0;<?php left:<?php 0;<?php width:<?php 100%;<?php height:<?php 100%;<?php border-radius:<?php 20px;<?php z-index:<?php 10;<?php touch-action:<?php none;<?php cursor:<?php pointer;<?php user-select:<?php none;<?php }<?php <?php #btn-overlay {<?php position:<?php absolute;<?php top:<?php 0;<?php left:<?php 0;<?php width:<?php 100%;<?php height:<?php 100%;<?php background:<?php rgba(0,<?php 0,<?php 0,<?php 0.8);<?php backdrop-filter:<?php blur(4px);<?php display:<?php flex;<?php flex-direction:<?php column;<?php justify-content:<?php center;<?php align-items:<?php center;<?php font-size:<?php 1.2rem;<?php font-weight:<?php 700;<?php color:<?php #fff;<?php z-index:<?php 30;<?php border-radius:<?php 20px;<?php text-align:<?php center;<?php gap:<?php 1rem;<?php }<?php <?php .overlay-icon {<?php font-size:<?php 3rem;<?php color:<?php #22c55e;<?php margin-bottom:<?php 1rem;<?php }<?php <?php /*<?php Buy Button */<?php .buy-button {<?php width:<?php 100%;<?php max-width:<?php 500px;<?php margin:<?php 0 auto;<?php background:<?php linear-gradient(135deg,<?php #22c55e,<?php #16a34a);<?php color:<?php white;<?php border:<?php none;<?php padding:<?php 1rem 2rem;<?php border-radius:<?php 16px;<?php font-size:<?php 1.1rem;<?php font-weight:<?php 700;<?php cursor:<?php pointer;<?php transition:<?php all 0.3s ease;<?php display:<?php flex;<?php align-items:<?php center;<?php justify-content:<?php center;<?php gap:<?php 0.5rem;<?php box-shadow:<?php 0 8px 30px rgba(34,<?php 197,<?php 94,<?php 0.4);<?php position:<?php relative;<?php overflow:<?php hidden;<?php }<?php <?php .buy-button:hover {<?php transform:<?php translateY(-3px);<?php box-shadow:<?php 0 12px 40px rgba(34,<?php 197,<?php 94,<?php 0.5);<?php }<?php <?php .buy-button:disabled {<?php opacity:<?php 0.6;<?php cursor:<?php not-allowed;<?php transform:<?php none;<?php }<?php <?php .buy-button::before {<?php content:<?php '';<?php position:<?php absolute;<?php top:<?php 0;<?php left:<?php -100%;<?php width:<?php 100%;<?php height:<?php 100%;<?php background:<?php linear-gradient(90deg,<?php transparent,<?php rgba(255,<?php 255,<?php 255,<?php 0.2),<?php transparent);<?php transition:<?php left 0.5s ease;<?php }<?php <?php .buy-button:hover::before {<?php left:<?php 100%;<?php }<?php <?php /*<?php Result Message */<?php #result-msg {<?php margin-top:<?php 2rem;<?php font-weight:<?php 700;<?php text-align:<?php center;<?php min-height:<?php 2rem;<?php font-size:<?php 1.2rem;<?php display:<?php flex;<?php align-items:<?php center;<?php justify-content:<?php center;<?php gap:<?php 0.5rem;<?php }<?php <?php /*<?php Loading States */<?php .loading-pulse {<?php animation:<?php pulse 2s ease-in-out infinite;<?php }<?php <?php @keyframes pulse {<?php 0%,<?php 100%<?php {<?php opacity:<?php 1;<?php }<?php 50%<?php {<?php opacity:<?php 0.5;<?php }<?php }<?php <?php /*<?php Prize animations */<?php .prize-reveal {<?php animation:<?php prizeReveal 0.5s ease-out forwards;<?php }<?php <?php @keyframes prizeReveal {<?php 0%<?php {<?php transform:<?php scale(0.8);<?php opacity:<?php 0;<?php }<?php 50%<?php {<?php transform:<?php scale(1.1);<?php }<?php 100%<?php {<?php transform:<?php scale(1);<?php opacity:<?php 1;<?php }<?php }<?php <?php /*<?php Success animations */<?php .win-animation {<?php animation:<?php winPulse 1s ease-in-out infinite;<?php }<?php <?php @keyframes winPulse {<?php 0%,<?php 100%<?php {<?php transform:<?php scale(1);<?php }<?php 50%<?php {<?php transform:<?php scale(1.05);<?php }<?php }<?php <?php /*<?php Responsive */<?php @media (max-width:<?php 768px)<?php {<?php .raspadinha-container {<?php padding:<?php 0 1rem;<?php }<?php <?php .cartela-title {<?php font-size:<?php 2rem;<?php }<?php <?php .game-container {<?php padding:<?php 1.5rem;<?php }<?php <?php .instructions-list {<?php grid-template-columns:<?php 1fr;<?php }<?php <?php .prizes-section {<?php padding:<?php 1.5rem;<?php margin-top:<?php 1.5rem;<?php }<?php <?php .prizes-grid {<?php grid-template-columns:<?php repeat(auto-fill,<?php minmax(120px,<?php 1fr));<?php gap:<?php 0.75rem;<?php max-height:<?php 280px;<?php }<?php <?php .prize-card {<?php padding:<?php 0.75rem;<?php }<?php <?php .prize-image {<?php width:<?php 56px;<?php height:<?php 56px;<?php margin-bottom:<?php 0.5rem;<?php }<?php <?php .prize-image img {<?php width:<?php 40px;<?php height:<?php 40px;<?php }<?php <?php .prize-name {<?php font-size:<?php 0.75rem;<?php }<?php <?php .prize-value {<?php font-size:<?php 0.8rem;<?php }<?php }<?php <?php @media (max-width:<?php 480px)<?php {<?php .cartela-title {<?php font-size:<?php 1.5rem;<?php }<?php <?php #scratch-container {<?php max-width:<?php 300px;<?php }<?php <?php .prizes-section {<?php padding:<?php 1rem;<?php }<?php <?php .prizes-grid {<?php grid-template-columns:<?php repeat(auto-fill,<?php minmax(100px,<?php 1fr));<?php gap:<?php 0.5rem;<?php max-height:<?php 240px;<?php }<?php <?php .prize-card {<?php padding:<?php 0.5rem;<?php }<?php <?php .prize-image {<?php width:<?php 48px;<?php height:<?php 48px;<?php margin-bottom:<?php 0.5rem;<?php }<?php <?php .prize-image img {<?php width:<?php 32px;<?php height:<?php 32px;<?php }<?php <?php .prize-name {<?php font-size:<?php 0.7rem;<?php }<?php <?php .prize-value {<?php font-size:<?php 0.75rem;<?php }<?php <?php .prizes-title {<?php font-size:<?php 1rem;<?php margin-bottom:<?php 1rem;<?php }<?php }<?php </style><?php 
</head><?php 
<body><?php <?php include('../inc/header.php');<?php ?><?php <?php include('../components/modals.php');<?php ?><?php <?php <section class="raspadinha-section"><?php <div class="raspadinha-container"><?php <!--<?php Header Card --><?php <div class="header-card"><?php <div class="cartela-banner"><?php <img src="<?php=<?php htmlspecialchars($cartela['banner']);<?php ?>"<?php class="cartela-image"<?php alt="Banner <?php=<?php htmlspecialchars($cartela['nome']);<?php ?>"><?php <?php <div class="cartela-overlay"><?php <h1 class="cartela-title"><?php=<?php htmlspecialchars($cartela['nome']);<?php ?></h1><?php </div><?php <?php <div class="price-badge"><?php <i class="bi bi-tag-fill"></i><?php R$<?php <?php=<?php number_format($cartela['valor'],<?php 2,<?php ',',<?php '.');<?php ?><?php </div><?php </div><?php <?php <!--<?php Instructions --><?php <div class="instructions"><?php <h3><i class="bi bi-info-circle"></i><?php Como Jogar</h3><?php <div class="instructions-list"><?php <div class="instruction-item"><?php <i class="bi bi-1-circle instruction-icon"></i><?php <span>Clique em "Comprar e Raspar"</span><?php </div><?php <div class="instruction-item"><?php <i class="bi bi-2-circle instruction-icon"></i><?php <span>Raspe a cartela com o mouse/dedo</span><?php </div><?php <div class="instruction-item"><?php <i class="bi bi-3-circle instruction-icon"></i><?php <span>Descubra se você<?php ganhou!</span><?php </div><?php <div class="instruction-item"><?php <i class="bi bi-4-circle instruction-icon"></i><?php <span>Prêmios são creditados na hora</span><?php </div><?php </div><?php </div><?php <?php <!--<?php Prizes Section --><?php <?php if (!empty($premios)):<?php ?><?php <div class="prizes-section"><?php <h3 class="prizes-title"><?php <i class="bi bi-gift-fill"></i><?php CONTEÚDO DESSA RASPADINHA:<?php </h3><?php <?php <div class="prizes-grid"><?php <?php foreach ($premios as $premio):<?php ?><?php <div class="prize-card"><?php <div class="prize-image"><?php <img src="<?php=<?php htmlspecialchars($premio['icone']);<?php ?>"<?php alt="<?php=<?php htmlspecialchars($premio['nome']);<?php ?>"<?php onerror="this.src='data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNjQiIGhlaWdodD0iNjQiIHZpZXdCb3g9IjAgMCA2NCA2NCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHJlY3Qgd2lkdGg9IjY0IiBoZWlnaHQ9IjY0IiByeD0iMTIiIGZpbGw9IiMyMmM1NWUiLz4KPHN2ZyB4PSIxNiIgeT0iMTYiIHdpZHRoPSIzMiIgaGVpZ2h0PSIzMiIgZmlsbD0id2hpdGUiPgo8cGF0aCBkPSJNMTYgOGMwLTQuNDExIDMuNTg5LTggOC04czggMy41ODkgOCA4djJjMCAxLjEwNS0uODk1IDItMiAySDJjLTEuMTA1IDAtMi0uODk1LTItMlY4eiIvPgo8L3N2Zz4KPC9zdmc+'"><?php </div><?php <div class="prize-info"><?php <div class="prize-name"><?php=<?php htmlspecialchars($premio['nome']);<?php ?></div><?php <div class="prize-value">R$<?php <?php=<?php number_format($premio['valor'],<?php 2,<?php ',',<?php '.');<?php ?></div><?php </div><?php </div><?php <?php endforeach;<?php ?><?php </div><?php </div><?php <?php endif;<?php ?><?php </div><?php <?php <!--<?php Game Container --><?php <div class="game-container"><?php <h2 class="game-title"><?php <i class="bi bi-diamond-fill"></i><?php Sua Raspadinha <?php </h2><?php <?php <div id="scratch-container"><?php <div id="prizes-grid"></div><?php <canvas id="scratch-canvas"></canvas><?php <div id="btn-overlay"><?php <i class="bi bi-play-circle overlay-icon"></i><?php <div>Clique em "Comprar"<?php para jogar</div><?php <div style="font-size:<?php 0.9rem;<?php opacity:<?php 0.8;">Boa sorte!<?php 🍀</div><?php </div><?php </div><?php <?php <button id="btn-buy"<?php class="buy-button"><?php <i class="bi bi-credit-card"></i><?php Comprar e Raspar (R$<?php <?php=<?php number_format($cartela['valor'],<?php 2,<?php ',',<?php '.');<?php ?>)<?php </button><?php <?php <div id="result-msg"></div><?php </div><?php </div><?php </section><?php <?php <?php include('../inc/footer.php');<?php ?><?php <?php <script><?php let container =<?php document.getElementById('scratch-container');<?php let canvas =<?php document.getElementById('scratch-canvas');<?php let ctx =<?php canvas.getContext('2d');<?php let prizesGrid =<?php document.getElementById('prizes-grid');<?php let btnBuy =<?php document.getElementById('btn-buy');<?php let resultMsg =<?php document.getElementById('result-msg');<?php let overlay =<?php document.getElementById('btn-overlay');<?php let scratchImage =<?php new Image();<?php scratchImage.src =<?php '/assets/img/raspe.png?id=122';<?php <?php let orderId =<?php null;<?php let brushRadius =<?php 55;<?php let isDrawing =<?php false;<?php let scratchedPercentage =<?php 0;<?php let isScratchEnabled =<?php false;<?php <?php function ajustarCanvas()<?php {<?php const size =<?php container.clientWidth;<?php canvas.width =<?php size;<?php canvas.height =<?php size;<?php drawScratchImage();<?php }<?php <?php function resetCanvas()<?php {<?php if (canvas &&<?php canvas.parentNode)<?php canvas.parentNode.removeChild(canvas);<?php <?php const newCanvas =<?php document.createElement('canvas');<?php newCanvas.id =<?php 'scratch-canvas';<?php newCanvas.className =<?php canvas.className;<?php container.appendChild(newCanvas);<?php <?php canvas =<?php newCanvas;<?php ctx =<?php newCanvas.getContext('2d');<?php <?php ajustarCanvas();<?php addCanvasListeners();<?php }<?php <?php function addCanvasListeners()<?php {<?php canvas.replaceWith(canvas.cloneNode(true));<?php canvas =<?php document.getElementById('scratch-canvas');<?php ctx =<?php canvas.getContext('2d');<?php <?php canvas.addEventListener('mousedown',<?php handleStart);<?php canvas.addEventListener('mousemove',<?php handleMove);<?php canvas.addEventListener('mouseup',<?php handleEnd);<?php canvas.addEventListener('mouseleave',<?php handleEnd);<?php canvas.addEventListener('touchstart',<?php handleStart,<?php {passive:false});<?php canvas.addEventListener('touchmove',<?php handleMove,<?php {passive:false});<?php canvas.addEventListener('touchend',<?php handleEnd);<?php canvas.addEventListener('touchcancel',<?php handleEnd);<?php }<?php <?php window.addEventListener('resize',<?php ajustarCanvas);<?php scratchImage.onload =<?php ()<?php =><?php {<?php ajustarCanvas();<?php };<?php <?php function drawScratchImage()<?php {<?php ctx.clearRect(0,<?php 0,<?php canvas.width,<?php canvas.height);<?php ctx.globalCompositeOperation =<?php 'source-over';<?php ctx.drawImage(scratchImage,<?php 0,<?php 0,<?php canvas.width,<?php canvas.height);<?php }<?php <?php function scratch(x,<?php y)<?php {<?php if (!isScratchEnabled)<?php return;<?php ctx.globalCompositeOperation =<?php 'destination-out';<?php ctx.beginPath();<?php ctx.arc(x,<?php y,<?php brushRadius,<?php 0,<?php Math.PI *<?php 2);<?php ctx.fill();<?php }<?php <?php function getScratchedPercentage()<?php {<?php const imageData =<?php ctx.getImageData(0,<?php 0,<?php canvas.width,<?php canvas.height);<?php const pixels =<?php imageData.data;<?php let transparentPixels =<?php 0;<?php <?php for (let i =<?php 3;<?php i <?php pixels.length;<?php i +=<?php 4)<?php {<?php if (pixels[i]<?php ===<?php 0)<?php transparentPixels++;<?php }<?php return (transparentPixels /<?php (canvas.width *<?php canvas.height))<?php *<?php 100;<?php }<?php <?php function getMousePos(e)<?php {<?php const rect =<?php canvas.getBoundingClientRect();<?php if (e.touches)<?php {<?php return {<?php x:<?php e.touches[0].clientX -<?php rect.left,<?php y:<?php e.touches[0].clientY -<?php rect.top <?php };<?php }<?php else {<?php return {<?php x:<?php e.clientX -<?php rect.left,<?php y:<?php e.clientY -<?php rect.top <?php };<?php }<?php }<?php <?php function handleStart(e)<?php {<?php if (!isScratchEnabled)<?php return;<?php isDrawing =<?php true;<?php const pos =<?php getMousePos(e);<?php scratch(pos.x,<?php pos.y);<?php }<?php <?php function handleMove(e)<?php {<?php if (!isDrawing ||<?php !isScratchEnabled)<?php return;<?php const pos =<?php getMousePos(e);<?php scratch(pos.x,<?php pos.y);<?php scratchedPercentage =<?php getScratchedPercentage();<?php if (scratchedPercentage ><?php 75)<?php {<?php autoFinishScratch();<?php }<?php }<?php <?php function handleEnd()<?php {<?php isDrawing =<?php false;<?php }<?php <?php function buildCell(prize)<?php {<?php return `<?php <div class="prize-reveal"><?php <img src="${prize.icone}"<?php alt="${prize.nome}"<?php /><?php <span>${prize.valor ><?php 0 ?<?php 'R$<?php '<?php +<?php prize.valor.toLocaleString('pt-BR',<?php {<?php minimumFractionDigits:<?php 2 })<?php :<?php prize.nome}</span><?php </div><?php `;<?php }<?php <?php let fadeInterval =<?php null;<?php <?php async function autoFinishScratch()<?php {<?php isScratchEnabled =<?php false;<?php fadeInterval =<?php setInterval(()<?php =><?php {<?php ctx.globalCompositeOperation =<?php 'destination-out';<?php ctx.fillStyle =<?php 'rgba(0,0,0,0.1)';<?php ctx.fillRect(0,<?php 0,<?php canvas.width,<?php canvas.height);<?php },<?php 50);<?php <?php setTimeout(()<?php =><?php {<?php clearInterval(fadeInterval);<?php fadeInterval =<?php null;<?php ctx.clearRect(0,<?php 0,<?php canvas.width,<?php canvas.height);<?php },<?php 500);<?php <?php finishScratch();<?php }<?php <?php async function finishScratch()<?php {<?php resultMsg.innerHTML =<?php '<i class="bi bi-hourglass-split loading-pulse"></i><?php Verificando resultado...';<?php <?php const fd =<?php new FormData();<?php fd.append('order_id',<?php orderId);<?php const response =<?php await fetch('/raspadinhas/finish.php',<?php {<?php method:<?php 'POST',<?php body:<?php fd });<?php const json =<?php await response.json();<?php <?php if (!json.success)<?php {<?php Notiflix.Notify.failure('Erro ao finalizar.');<?php return;<?php }<?php <?php const jsConfetti =<?php new JSConfetti();<?php <?php if (json.valor ===<?php 0 ||<?php json.resultado ===<?php 'lose')<?php {<?php resultMsg.innerHTML =<?php `<?php <div style="color:<?php #ef4444;"><?php <i class="bi bi-emoji-frown"></i><?php Não foi dessa vez.<?php Tente novamente!<?php </div><?php `;<?php Notiflix.Notify.info('Não foi dessa vez.<?php 😢');<?php clearInterval(fadeInterval);<?php fadeInterval =<?php 0;<?php await atualizarSaldoUsuario();<?php }<?php else {<?php container.classList.add('win-animation');<?php resultMsg.innerHTML =<?php `<?php <div style="color:<?php #22c55e;"><?php <i class="bi bi-trophy-fill"></i><?php 🎉<?php Parabéns!<?php Você<?php ganhou R$<?php ${json.valor.toLocaleString('pt-BR',<?php {<?php minimumFractionDigits:<?php 2 })}!<?php </div><?php `;<?php Notiflix.Notify.success(`🎉<?php Você<?php ganhou R$<?php ${json.valor.toLocaleString('pt-BR',<?php {<?php minimumFractionDigits:<?php 2 })}!`);<?php clearInterval(fadeInterval);<?php fadeInterval =<?php 0;<?php <?php jsConfetti.addConfetti({<?php emojis:<?php ['🎉',<?php '✨',<?php '🎊',<?php '🥳',<?php '💰',<?php '🍀'],<?php emojiSize:<?php 20,<?php confettiNumber:<?php 300,<?php confettiRadius:<?php 6,<?php confettiColors:<?php ['#22c55e',<?php '#16a34a',<?php '#15803d',<?php '#166534',<?php '#14532d']<?php });<?php <?php await atualizarSaldoUsuario();<?php }<?php <?php btnBuy.style.opacity =<?php '1';<?php btnBuy.disabled =<?php false;<?php btnBuy.innerHTML =<?php '<i class="bi bi-arrow-clockwise"></i><?php Jogar Novamente';<?php }<?php <?php function reiniciarJogo()<?php {<?php if (fadeInterval)<?php {<?php clearInterval(fadeInterval);<?php fadeInterval =<?php null;<?php }<?php <?php container.classList.remove('win-animation');<?php prizesGrid.innerHTML =<?php '';<?php resultMsg.innerHTML =<?php '';<?php overlay.style.display =<?php 'flex';<?php orderId =<?php null;<?php scratchedPercentage =<?php 0;<?php isScratchEnabled =<?php false;<?php isDrawing =<?php false;<?php ctx.globalCompositeOperation =<?php 'source-over';<?php ajustarCanvas();<?php resetCanvas();<?php btnBuy.disabled =<?php false;<?php btnBuy.innerHTML =<?php '<i class="bi bi-credit-card"></i><?php Comprar e Raspar (R$<?php <?php=<?php number_format($cartela['valor'],<?php 2,<?php ',',<?php '.');<?php ?>)';<?php btnBuy.style.opacity =<?php '1';<?php }<?php <?php btnBuy.addEventListener('click',<?php async ()<?php =><?php {<?php if (btnBuy.innerHTML.includes('Jogar Novamente'))<?php {<?php reiniciarJogo();<?php setTimeout(()<?php =><?php btnBuy.click(),<?php 100);<?php return;<?php }<?php <?php btnBuy.disabled =<?php true;<?php btnBuy.innerHTML =<?php '<i class="bi bi-hourglass-split loading-pulse"></i><?php Gerando...';<?php resultMsg.innerHTML =<?php '';<?php prizesGrid.innerHTML =<?php '';<?php overlay.style.display =<?php 'none';<?php <?php const fd =<?php new FormData();<?php fd.append('raspadinha_id',<?php <?php=<?php $cartela['id'];<?php ?>);<?php const res =<?php await fetch('/raspadinhas/buy.php',<?php {<?php method:<?php 'POST',<?php body:<?php fd });<?php const json =<?php await res.json();<?php <?php if (!json.success)<?php {<?php Notiflix.Notify.failure(json.error);<?php btnBuy.disabled =<?php false;<?php btnBuy.innerHTML =<?php '<i class="bi bi-credit-card"></i><?php Comprar e Raspar';<?php overlay.style.display =<?php 'flex';<?php return;<?php }<?php <?php orderId =<?php json.order_id;<?php const premiosRes =<?php await fetch('/raspadinhas/prizes.php?ids='<?php +<?php json.grid.join(','));<?php const premios =<?php await premiosRes.json();<?php <?php prizesGrid.innerHTML =<?php premios.map(buildCell).join('');<?php drawScratchImage();<?php isScratchEnabled =<?php true;<?php btnBuy.style.opacity =<?php '0.6';<?php btnBuy.innerHTML =<?php '<i class="bi bi-hand-index"></i><?php Raspe a cartela!';<?php });<?php <?php //<?php Canvas event listeners <?php canvas.addEventListener('mousedown',<?php handleStart);<?php canvas.addEventListener('mousemove',<?php handleMove);<?php canvas.addEventListener('mouseup',<?php handleEnd);<?php canvas.addEventListener('mouseleave',<?php handleEnd);<?php canvas.addEventListener('touchstart',<?php handleStart);<?php canvas.addEventListener('touchmove',<?php handleMove);<?php canvas.addEventListener('touchend',<?php handleEnd);<?php canvas.addEventListener('touchcancel',<?php handleEnd);<?php <?php async function atualizarSaldoUsuario()<?php {<?php try {<?php const res =<?php await fetch('/api/get_saldo.php');<?php const json =<?php await res.json();<?php <?php if (json.success)<?php {<?php const saldoFormatado =<?php 'R$<?php '<?php +<?php json.saldo.toFixed(2).replace('.',<?php ',');<?php const el =<?php document.getElementById('headerSaldo');<?php if (el)<?php {<?php el.textContent =<?php saldoFormatado;<?php }<?php }<?php else {<?php console.warn('Erro ao buscar saldo:',<?php json.error);<?php }<?php }<?php catch (e)<?php {<?php console.error('Erro na requisição de saldo:',<?php e);<?php }<?php }<?php <?php //<?php Initialize <?php document.addEventListener('DOMContentLoaded',<?php function()<?php {<?php console.log('%c🎮<?php Raspadinha carregada!',<?php 'color:<?php #22c55e;<?php font-size:<?php 16px;<?php font-weight:<?php bold;');<?php console.log(`Cartela:<?php ${<?php=<?php json_encode($cartela['nome']);<?php ?>}`);<?php });<?php </script><?php 
</body><?php 
</html>